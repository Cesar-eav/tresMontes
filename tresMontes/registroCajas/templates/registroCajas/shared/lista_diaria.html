{% extends '../base.html' %}
{% block title %}Lista Diaria{% endblock %}
{% block content %}
<div class="header"><h2>Lista Diaria de Entregas</h2></div>
<div class="content">
    {% if campana_activa %}
    <div class="card">
        <div class="card-header"><i class="bi bi-funnel me-2"></i> Filtros</div>
        <div class="card-body">
            <form method="GET" class="row g-2">
                <div class="col-6"><select name="filtro_tipo" class="form-control" onchange="this.form.submit()"><option value="todos" {% if filtro_tipo == 'todos' %}selected{% endif %}>Todos</option><option value="planta" {% if filtro_tipo == 'planta' %}selected{% endif %}>Planta</option><option value="contratista" {% if filtro_tipo == 'contratista' %}selected{% endif %}>Contratista</option></select></div>
                <div class="col-6"><input type="text" id="busqueda_lista_diaria" name="busqueda" class="form-control" placeholder="Buscar por nombre o RUT..." value="{{ busqueda }}"></div>
            </form>
        </div>
    </div>
    <div class="stats-container">
        <div class="stat-card"><div class="stat-number">{{ total_beneficiarios }}</div><div class="stat-label">Total</div></div>
        <div class="stat-card"><div class="stat-number">{{ total_entregados }}</div><div class="stat-label">Entregados</div></div>
        <div class="stat-card"><div class="stat-number">{{ total_pendientes }}</div><div class="stat-label">Pendientes</div></div>
    </div>
    <div class="card">
        <div class="card-header"><i class="bi bi-list-check me-2"></i> Beneficiarios ({{ total_beneficiarios }})</div>
        <div class="card-body">
            {% for item in beneficiarios %}
            <div class="list-item">
                <div>
                    <strong>{{ item.beneficiario.nombre }}</strong>
                    <div class="text-muted small">
                        {{ item.beneficiario.rut }} | {{ item.beneficiario.get_tipo_contrato_display }} | {{ item.beneficiario.get_tipo_caja_display }}
                        {% if item.tiene_retiro %}
                        <br><span class="badge bg-info">CÃ³digo: {{ item.beneficiario.retiro.codigo_caja }}</span>
                        {% endif %}
                    </div>
                </div>
                {% if item.tiene_retiro %}
                <span class="status-badge status-delivered"><i class="bi bi-check-circle me-1"></i> Entregado</span>
                {% else %}
                <span class="status-badge status-pending"><i class="bi bi-clock me-1"></i> Pendiente</span>
                {% endif %}
            </div>
            {% empty %}<p class="text-muted text-center">No hay beneficiarios</p>{% endfor %}
        </div>
    </div>
    {% else %}
    <div class="alert alert-info"><i class="bi bi-info-circle me-2"></i> No hay carga activa en este momento.</div>
    {% endif %}
</div>
{% endblock %}
{% block footer %}
    {% include 'registroCajas/shared/footer.html' with active_nav='lista' %}
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        vincularFormateadorRUT('busqueda_lista_diaria');
    });
</script>
{% endblock %}
