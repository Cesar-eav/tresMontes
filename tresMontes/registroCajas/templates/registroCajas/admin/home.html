{% extends '../base.html' %}
{% load static %}

{% block title %}Panel Admin - Tres Montes{% endblock %}

{% block content %}
<div class="header">
    <h2>Panel Admin</h2>
</div>

<div class="content">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    {% if not campana_activa %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            No hay cargas activas para la planta <strong>{{ planta.nombre }}</strong>.
            <br><br>
            <a href="{% url 'admin_crear_campana' %}" class="btn btn-primary btn-sm">
                <i class="bi bi-calendar-plus me-2"></i>Crear Nueva Carga
            </a>
        </div>
    {% else %}
        <!-- Estadísticas -->
        <div class="stats-container mb-4">
            <div class="stat-card">
                <div class="stat-number">{{ tasa_entrega }}%</div>
                <div class="stat-label">Tasa de Entrega</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ entregas_hoy }}</div>
                <div class="stat-label">Entregados Hoy</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ total_pendientes }}</div>
                <div class="stat-label">Pendientes</div>
            </div>
        </div>

        <!-- Acciones Rápidas -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-plus-circle me-2"></i> Acciones Rápidas
            </div>
            <div class="card-body">
                <div class="d-grid gap-3 d-md-flex justify-content-center">
                    <a href="{% url 'admin_crear_campana' %}" class="btn btn-primary btn-lg">
                        <i class="bi bi-calendar-plus me-2"></i> Crear Nueva Entrega
                    </a>
                    <a href="{% url 'admin_gestionar_cargas' %}" class="btn btn-outline-primary btn-lg">
                        <i class="bi bi-folder me-2"></i> Gestionar Cargas
                    </a>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-7 mb-4 mb-lg-0">
                <!-- Actividad Reciente -->
                <div class="card h-100">
                    <div class="card-header">
                        <i class="bi bi-list-check me-2"></i> Actividad Reciente
                    </div>
                    <div class="card-body">
                        {% if entregas_recientes %}
                            {% for retiro in entregas_recientes %}
                                <div class="list-item">
                                    <div>
                                        <strong>{{ retiro.beneficiario.nombre }}</strong>
                                        <div class="text-muted small">
                                            {{ retiro.fecha_hora|date:"H:i" }}
                                            {% if retiro.retirado_por_tercero %}
                                                - <i class="bi bi-person-check"></i> {{ retiro.nombre_tercero }}
                                            {% endif %}
                                        </div>
                                    </div>
                                    <span class="status-badge status-delivered">Entregado</span>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-muted text-center mb-0">No hay entregas registradas hoy</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <!-- Info de la Carga Activa -->
                <div class="card h-100">
                    <div class="card-header">
                        <i class="bi bi-calendar-event me-2"></i> Carga Activa
                    </div>
                    <div class="card-body">
                        <div class="list-item">
                            <span>Nombre:</span>
                            <strong>{{ campana_activa.nombre }}</strong>
                        </div>
                        <div class="list-item">
                            <span>Fecha Inicio:</span>
                            <strong>{{ campana_activa.fecha_inicio|date:"d/m/Y" }}</strong>
                        </div>
                        <div class="list-item">
                            <span>Fecha Fin:</span>
                            <strong>{{ campana_activa.fecha_fin|date:"d/m/Y" }}</strong>
                        </div>
                        <div class="list-item">
                            <span>Total Beneficiarios:</span>
                            <strong>{{ total_beneficiarios }}</strong>
                        </div>
                        <div class="list-item">
                            <span>Entregados:</span>
                            <strong class="text-success">{{ total_entregados }}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block footer %}
    {% include 'registroCajas/shared/footer.html' with active_nav='home' %}
{% endblock %}
