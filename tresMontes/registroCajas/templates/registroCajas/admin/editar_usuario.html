{% extends '../base.html' %}
{% block title %}Editar Usuario{% endblock %}
{% block content %}
<div class="header">
    <a href="{% url 'admin_usuarios' %}" style="position: absolute; left: 15px; color: white;"><i class="bi bi-arrow-left"></i></a>
    <h2>Editar Usuario</h2>
</div>
<div class="content">
    {% if messages %}{% for message in messages %}<div class="alert alert-{{ message.tags }}">{{ message }}</div>{% endfor %}{% endif %}
    <div class="card">
        <div class="card-body">
            <form method="POST">{% csrf_token %}
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Nombre Completo *</label>
                            <input type="text" name="nombre_completo" class="form-control" value="{{ perfil.nombre_completo }}" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Usuario *</label>
                            <input type="text" name="username" class="form-control" value="{{ perfil.user.username }}" required>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Nueva Contraseña</label>
                            <input type="password" name="password" class="form-control" placeholder="Dejar en blanco para no cambiar">
                            <small class="text-muted">Solo ingrese una contraseña si desea cambiarla</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" name="email" class="form-control" value="{{ perfil.user.email }}">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>RUT</label>
                            <input type="text" id="rut_editar_usuario" name="rut" class="form-control" placeholder="12.345.678-9" value="{{ perfil.rut|default:'' }}">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Rol *</label>
                            <select name="rol" class="form-control" required>
                                <option value="admin" {% if perfil.rol == 'admin' %}selected{% endif %}>Administrador</option>
                                <option value="guardia" {% if perfil.rol == 'guardia' %}selected{% endif %}>Guardia</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Planta *</label>
                            <select name="planta" class="form-control" required>
                                {% for planta in plantas %}
                                <option value="{{ planta.id }}" {% if planta.id == perfil.planta.id %}selected{% endif %}>{{ planta.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="text-end">
                    <a href="{% url 'admin_usuarios' %}" class="btn btn-secondary">Cancelar</a>
                    <button type="submit" class="btn btn-primary"><i class="bi bi-check-circle me-2"></i> Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        vincularFormateadorUsuarioRUT('rut_editar_usuario');
    });
</script>
{% endblock %}

{% block footer %}
    {% include 'registroCajas/shared/footer.html' with active_nav='usuarios' %}
{% endblock %}
